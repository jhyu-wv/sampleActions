# .github/workflows/mentis-sync.yml
name: 멘티스 RSS 동기화

on:
  schedule:
    # 매일 오전 9시 (UTC 0시)에 실행
    - cron: '0 0 1 * *'
  
  # 수동 실행 가능
  workflow_dispatch:
  
  # 테스트를 위한 push 트리거 (선택사항)
  # push:
  #   branches: [ main ]

jobs:
  sync-mentis:
    runs-on: ubuntu-latest
    
    # 권한 설정
    permissions:
      issues: write    # 이슈 생성/수정용
      contents: write  # 상태 파일 커밋용
      repository-projects: write  # 프로젝트 접근용
      actions: read
      statuses: write
    
    steps:
    - name: 체크아웃
      uses: actions/checkout@v4
    
    - name: Python 설정
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: 의존성 설치
      run: |
        python -m pip install --upgrade pip
        pip install feedparser requests
    
    - name: 멘티스 RSS 동기화 실행
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        PROJECT_ID: ${{ secrets.PROJECT_ID }}
        REPO_OWNER: ${{ github.repository_owner }}
        REPO_NAME: ${{ github.event.repository.name }}
        MENTIS_RSS_URL: ${{ secrets.MENTIS_RSS_URL }}
        PROJECT_DEFAULT_STATUS: ${{ vars.PROJECT_DEFAULT_STATUS }}
      run: python scripts/sync_mentis.py